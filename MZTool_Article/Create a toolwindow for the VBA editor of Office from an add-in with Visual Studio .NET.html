

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app28.us.archive.org';v.server_ms=371;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="/_static/js/bundle-playback.js?v=U25-Dms9" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=UHAOicsW" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("https://www.mztools.com/articles/2012/MZ2012017.aspx","20211024050815","https://web.archive.org/","web","/_static/",
	      "1635052095");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=fantwOh2" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->
<meta http-equiv="content-type" content="text/html; charset=iso-8859-15"/>
<title>
	HOWTO: Create a toolwindow for the VBA editor of Office from an add-in with Visual Studio .NET.
</title><link rel="stylesheet" type="text/css" href="/web/20211024050815cs_/https://www.mztools.com/css/mztools.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/web/20211024050815im_/https://www.mztools.com/images/favicon.ico"/><link rel="apple-touch-icon" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon.png"/><link rel="apple-touch-icon" sizes="57x57" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="72x72" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/web/20211024050815im_/https://www.mztools.com/images/apple-touch-icon-152x152.png"/>

   <script type="text/javascript" src="/web/20211024050815js_/https://www.mztools.com/scripts/mztools.js"></script>
   <script type="text/javascript" src="/web/20211024050815js_/https://www.mztools.com/scripts/google-analytics.js"></script>
 </head>
<body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20211024050815/https%3A//www.mztools.com/articles/2012/MZ2012017.aspx"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="https://www.mztools.com/articles/2012/MZ2012017.aspx" onfocus="this.focus();this.select();" style="flex:1;"/><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20211024050815" /><input type="submit" value="Go" />
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
		<div class="s" id="wm-nav-captures" style="flex:1;">
	  	  <a class="t" href="/web/20211024050815*/https://www.mztools.com/articles/2012/MZ2012017.aspx" title="See a list of every capture for this URL">9 captures</a>
	  <div class="r" title="Timespan for captures of this URL">06 Oct 2012 - 24 Oct 2021</div>
	  </div>
	<div class="k">
	  <a href="" id="wm-graph-anchor">
	    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
	      <canvas id="wm-sparkline-canvas" width="675" height="27" border="0"></canvas>
	    </div>
	  </a>
	</div>
      </div>
    </div>
    <div class="n">
      <table>
	<tbody>
	  <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
	  <tr class="m">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20190331190835/http://www.mztools.com:80/articles/2012/MZ2012017.aspx" title="31 Mar 2019"><strong>Mar</strong></a></td>
	    <td class="c" id="displayMonthEl" title="You are here: 05:08:15 Oct 24, 2021">OCT</td>
	    <td class="f" nowrap="nowrap">Nov</td>
	  </tr>
	  <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
	  <tr class="d">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20190331190835/http://www.mztools.com:80/articles/2012/MZ2012017.aspx" title="19:08:35 Mar 31, 2019"><img src="/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
	    <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 05:08:15 Oct 24, 2021">24</td>
	    <td class="f" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0" /></td>
	  </tr>
	  <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
	  <tr class="y">
	    <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20190331190835/http://www.mztools.com:80/articles/2012/MZ2012017.aspx" title="31 Mar 2019"><strong>2019</strong></a></td>
	    <td class="c" id="displayYearEl" title="You are here: 05:08:15 Oct 24, 2021">2021</td>
	    <td class="f" nowrap="nowrap">2022</td>
	  </tr>
	</tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
        	<span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
	</span>
        	<a class="xxs" href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="/web/20211024050815/http://web.archive.org/screenshot/https://www.mztools.com/articles/2012/MZ2012017.aspx"
           id="wm-screenshot"
           title="screenshot">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20211024050815/https://www.mztools.com/articles/2012/MZ2012017.aspx" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20211024050815/https://www.mztools.com/articles/2012/MZ2012017.aspx" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
	<a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/commoncrawl)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/commoncrawl" target="_new"><span class="wm-title">Common Crawl</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Web crawl data from Common Crawl.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20211024050815/https://www.mztools.com/articles/2012/MZ2012017.aspx</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(675,27,25,2,"web","https://www.mztools.com/articles/2012/MZ2012017.aspx","20211024050815",1996,"/_static/",["/_static/css/banner-styles.css?v=fantwOh2","/_static/css/iconochive.css?v=qtvMKcIJ"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT -->
   <div style="width: 1000px; margin-left:auto;margin-right:auto; background-color: #FFFFFF; padding: 6px; border: 1px; border-style: solid; border-color: #A0A0A0;">
      <table class="non_printable" cellspacing="0" cellpadding="0" width="100%" border="0">
         <tr>
            <td style="line-height: 1px; width: 10px"><img height="10" width="10" alt="" src="/web/20211024050815im_/https://www.mztools.com/images/borders/top_left_dark_blue.png"/></td>
            <!-- We need to use width: 980px rather than width: 100% to work in IE 8.0 -->
            <td style="line-height: 1px; width: 980px; background-color: #04223A" colspan="3"></td>
            <td style="line-height: 1px; width: 10px"><img height="10" width="10" alt="" src="/web/20211024050815im_/https://www.mztools.com/images/borders/top_right_dark_blue.png"/></td>
         </tr>
         <tr>
            <td colspan="5" style="background-color: #04223A; vertical-align: bottom; text-align: center"><a href="https://web.archive.org/web/20211024050815/http://www.mztools.com/"><img src="/web/20211024050815im_/https://www.mztools.com/images/mztools.png" style="border-width: 0" width="250" height="50" alt="Logo"/></a></td>
         </tr>
         <tr>
            <td style="line-height: 1px; width: 10px"><img src="/web/20211024050815im_/https://www.mztools.com/images/borders/bottom_left_dark_blue.png" height="10" width="10" alt=""/></td>
            <td style="line-height: 1px; width: 100%; background-color: #04223A" colspan="3"></td>
            <td style="line-height: 1px; width: 10px"><img src="/web/20211024050815im_/https://www.mztools.com/images/borders/bottom_right_dark_blue.png" height="10" width="10" alt=""/></td>
         </tr>
      </table>
      <table class="table_central" cellspacing="0" cellpadding="0" width="100%" border="0">
         <tr>
            <td id="Content" class="td_content">
               <div>
                  

<table cellspacing="0" cellpadding="0" class="table_header1"><tr><td class="td_header1_left" width="10px"></td><td class="td_header1_center"><b>HOWTO: Create a toolwindow for the VBA editor of Office from an add-in with Visual Studio .NET.</b></td><td class="td_header1_right" width="10px"></td></tr></table><br/>
<table border="0">
	<tr>
		<td><b>Author</b>: </td>
		<td>Carlos J. Quintero (Microsoft MVP)</td>
		<td class="td_article_header"><b>Applies to</b>:</td>
		<td>Microsoft Office 64-bit</td>
	</tr>
	<tr>
		<td><b>Date</b>:</td>
		<td>September 2012</td>
		<td>&nbsp;</td>
		<td>Microsoft Office 32-bit</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
	</tr>
	</table>

<span class="article_section">Introduction</span>
   <p>This article explains how to create a toolwindow (dockable window like the 
       Project Explorer) from an 
       add-in for the VBA editor of Office using Visual Studio .NET and the .NET 
       Framework.</p>
    <p>The sample code creates two buttons on the Standard toolbar that show a 
        different toolwindow each one.</p>
<span class="article_section">More information</span>
<p>Toolwindows are dockable, modeless windows that are created calling the 
    VBE.Windows.CreateToolWindow method. This method returns a VBE.Window instance, 
    which can be made visible setting its Window.Visible property to True. When 
    closed, toolwindows are not destroyed. Rather, they are made invisible.</p>
    <p>Toolwindows 
    host ActiveX UserDocuments inside, but UserDocuments don't exist in .NET. 
    Fortunately, Usercontrols can be used instead, with one caveat: the toolwindow 
        doesn't resize a UserControl automatically as it does with a UserDocument when 
        creating add-ins with Visual Basic 6.0 (the sample code provides a workaround).</p>
    <p>The VBE.Windows.CreateToolWindow method has these parameters:</p>
    <ul>
        <li>(Input) The add-in instance (that was received in the OnConnection method).</li>
        <li>(Input) The ProgId of the ActiveX UserDocument (or UserControl) that will be hosted. This class 
            must be Public and visible to COM (so it needs the ComVisible attribute and set 
            to True), and must be registered on the machine.
        </li>
        <li>(Input) The caption of the toolwindow.</li>
        <li>(Input) A GUID to uniquely identify the toolWindow. The VBA editor uses this 
            GUID to store information specific to each toolwindow, such as its size or position.</li>
        <li>(Output )The instance of the usercontrol that the method has created from the 
            ProgId that you passed as second parameter.</li>
    </ul>
   <p>To create the sample use the following steps:</p>
   <ul>
      <li>Create an add-in for the VBA editor of Microsoft Office as explained in the 
    article <a href="MZ2012013.aspx">HOWTO: Create an add-in for the VBA editor (32-bit or 64-bit) of Office with Visual Studio .NET</a>.</li>
       <li>Add two usercontrols named UserControlToolWindow1.vb and 
           UserControlToolWindow2.vb.</li>
       <li>Add a usercontrol named UserControlHost.vb to the project. This is the common 
           usercontrol that will be hosted by all toolwindows when calling the 
           VBE.Windows.CreateToolWindow method. In turn, this usercontrol will host the 
           specific usercontrol of each toolwindow (UserControlToolWindow1 and 
           UserControlToolWindow2). This approach of using an intermediate usercontrol to 
           host the actual usercontrols has the following advantages:<ul>
               <li>This UserControlHost control is the only one that needs to be Public and 
                   COM-registered. Otherwise each usercontrol of each toolwindow should be 
                   COM-registered.</li>
               <li>It provides a centralized workaround for the resizing problem.</li>
               <li>It provides a centralized workaround for a problem that exists in toolwindows of 
                   the VBA editor and VB5 (but not in VB6): keys such as Tab, Return, etc. don't work.</li>
           </ul>
       </li>
       <li>Change the code of the Connect.vb file by the code below. The code creates two 
           buttons on the Standard toolbar that shows different toolwindows. When a button 
           is clicked, if the toolwindow is not created yet, it is created. Since when 
           closing toolwindows they are not destroyed, just hidden, if the toolwindow was 
           already created it is made visible.</li>
   </ul>

<table width="100%" style="border-bottom-style:solid; border-bottom-color:Blue; border-bottom-width:1px"><tr><td>Language: VB.NET</td><td style="text-align:right"><span style="color:Blue; cursor:pointer" onclick="CopyToClipboard(document.getElementById('Code1'));">&nbsp;&nbsp;&nbsp;<img alt="Copy Code" style="border-style:none" src="/web/20211024050815im_/https://www.mztools.com/images/other/copy_code.png"/>&nbsp;Copy Code (IE only)</span></td></tr></table>

<pre class="article_source_code" id="Code1">
Imports MyCompany.Interop
Imports MyCompany.Interop.Extensibility
Imports System.Windows.Forms
Imports System.Runtime.InteropServices
Imports Microsoft.Office.Core
Imports System.Drawing

&lt;ComVisible(True), Guid(PUT_NEW_GUID_HERE), ProgId("MyVBAAddin.Connect")&gt; _
Public Class Connect
   Implements IDTExtensibility2

   Private _VBE As VBAExtensibility.VBE
   Private _AddIn As VBAExtensibility.AddIn
   Private WithEvents _CommandBarButton1 As CommandBarButton
   Private WithEvents _CommandBarButton2 As CommandBarButton

   Private _toolWindow1 As VBAExtensibility.Window
   Private _toolWindow2 As VBAExtensibility.Window

   Private Sub OnConnection(Application As Object, ConnectMode As ext_ConnectMode, AddInInst As Object, _
      ByRef custom As System.Array) Implements IDTExtensibility2.OnConnection

      Try

         _VBE = DirectCast(Application, VBAExtensibility.VBE)
         _AddIn = DirectCast(AddInInst, VBAExtensibility.AddIn)

         Select Case ConnectMode

            Case ext_ConnectMode.ext_cm_Startup
               ' OnStartupComplete will be called

            Case ext_ConnectMode.ext_cm_AfterStartup
               InitializeAddIn()

         End Select

      Catch ex As Exception

         MessageBox.Show(ex.ToString())

      End Try

   End Sub

   Private Sub OnDisconnection(RemoveMode As ext_DisconnectMode, _
      ByRef custom As System.Array) Implements IDTExtensibility2.OnDisconnection

      If Not _CommandBarButton1 Is Nothing Then

         _CommandBarButton1.Delete()
         _CommandBarButton1 = Nothing

      End If

      If Not _CommandBarButton2 Is Nothing Then

         _CommandBarButton2.Delete()
         _CommandBarButton2 = Nothing

      End If

   End Sub

   Private Sub OnStartupComplete(ByRef custom As System.Array) _
      Implements IDTExtensibility2.OnStartupComplete

      InitializeAddIn()

   End Sub

   Private Sub OnAddInsUpdate(ByRef custom As System.Array) _
      Implements IDTExtensibility2.OnAddInsUpdate

   End Sub

   Private Sub OnBeginShutdown(ByRef custom As System.Array) Implements IDTExtensibility2.OnBeginShutdown

   End Sub

   Private Sub InitializeAddIn()

      Dim standardCommandBar As CommandBar
      Dim commandBarControl As CommandBarControl

      Try

         standardCommandBar = _VBE.CommandBars.Item("Standard")

         commandBarControl = standardCommandBar.Controls.Add(MsoControlType.msoControlButton)
         _CommandBarButton1 = DirectCast(commandBarControl, CommandBarButton)
         _CommandBarButton1.Caption = "Toolwindow 1"
         _CommandBarButton1.FaceId = 59
         _CommandBarButton1.Style = MsoButtonStyle.msoButtonIconAndCaption
         _CommandBarButton1.BeginGroup = True

         commandBarControl = standardCommandBar.Controls.Add(MsoControlType.msoControlButton)
         _CommandBarButton2 = DirectCast(commandBarControl, CommandBarButton)
         _CommandBarButton2.Caption = "Toolwindow 2"
         _CommandBarButton2.FaceId = 59
         _CommandBarButton2.Style = MsoButtonStyle.msoButtonIconAndCaption
         _CommandBarButton2.BeginGroup = True

      Catch ex As Exception

         MessageBox.Show(ex.ToString())

      End Try

   End Sub

   Private Function CreateToolWindow(ByVal toolWindowCaption As String, ByVal toolWindowGuid As String, _
      ByVal toolWindowUserControl As UserControl) As VBAExtensibility.Window

      Dim userControlObject As Object = Nothing
      Dim userControlHost As UserControlHost
      Dim toolWindow As VBAExtensibility.Window
      Dim progId As String

      ' IMPORTANT: ensure that you use the same ProgId value used in the ProgId attribute of the UserControlHost class
      progId = "MyVBAAddin.UserControlHost"

      toolWindow = _VBE.Windows.CreateToolWindow(_AddIn, progId, toolWindowCaption, toolWindowGuid, userControlObject)
      userControlHost = DirectCast(userControlObject, UserControlHost)

      toolWindow.Visible = True

      userControlHost.AddUserControl(toolWindowUserControl)

      Return toolWindow

   End Function

   Private Sub _CommandBarButton1_Click(Ctrl As Microsoft.Office.Core.CommandBarButton, _
      ByRef CancelDefault As Boolean) Handles _CommandBarButton1.Click

      Dim userControlObject As Object = Nothing
      Dim userControlToolWindow1 As UserControlToolWindow1

      Try

         If _toolWindow1 Is Nothing Then

            userControlToolWindow1 = New UserControlToolWindow1()

            ' TODO: Change the GUID
            _toolWindow1 = CreateToolWindow("My toolwindow 1", "{PUT_NEW_GUID_HERE}", userControlToolWindow1)

            userControlToolWindow1.Initialize(_VBE)

         Else

            _toolWindow1.Visible = True

         End If

      Catch ex As Exception

         MessageBox.Show(ex.ToString)

      End Try

   End Sub

   Private Sub _CommandBarButton2_Click(Ctrl As Microsoft.Office.Core.CommandBarButton, _
      ByRef CancelDefault As Boolean) Handles _CommandBarButton2.Click

      Dim userControlObject As Object = Nothing
      Dim userControlToolWindow2 As UserControlToolWindow2

      Try

         If _toolWindow2 Is Nothing Then

            userControlToolWindow2 = New UserControlToolWindow2()

            ' TODO: Change the GUID
            _toolWindow2 = CreateToolWindow("My toolwindow 2", "{PUT_NEW_GUID_HERE}", userControlToolWindow2)

            userControlToolWindow2.Initialize(_VBE)

         Else

            _toolWindow2.Visible = True

         End If

      Catch ex As Exception

         MessageBox.Show(ex.ToString)

      End Try

   End Sub

End Class
</pre>

<ul>
    <li>Replace the code of UserControlHost by the code below.</li>
    <li>Notice that the scope of the usercontrol must be Public, and that it must have a 
        ProgId and be visible to COM.</li>
    <li>This usercontrol will host the actual usercontrol of the toolwindow (which will 
        have the DockStyle.Fill).</li>
    <li>It needs to do subclassing with the parent window to detect when the size is 
        changed.</li>
    <li>It needs to override the ProcessKeyPreview method to detect the Tab, Shift+Tab 
        and Return keys, to make them behave as expected.</li>
</ul>

<table width="100%" style="border-bottom-style:solid; border-bottom-color:Blue; border-bottom-width:1px"><tr><td>Language: VB.NET</td><td style="text-align:right"><span style="color:Blue; cursor:pointer" onclick="CopyToClipboard(document.getElementById('Code2'));">&nbsp;&nbsp;&nbsp;<img alt="Copy Code" style="border-style:none" src="/web/20211024050815im_/https://www.mztools.com/images/other/copy_code.png"/>&nbsp;Copy Code (IE only)</span></td></tr></table>

<pre class="article_source_code" id="Code2">
Imports System.Runtime.InteropServices
Imports System.Windows.Forms
Imports System.Drawing

&lt;ComVisible(True), Guid(PUT_NEW_GUID_HERE), ProgId("MyVBAAddin.UserControlHost")&gt; _
Public Class UserControlHost

   Private Class SubClassingWindow
      Inherits System.Windows.Forms.NativeWindow

      Public Event CallBackProc(ByRef m As Message)

      Public Sub New(ByVal handle As IntPtr)
         MyBase.AssignHandle(handle)
      End Sub

      Protected Overrides Sub WndProc(ByRef m As Message)

         Const WM_SIZE As Integer = &H5;

         If m.Msg = WM_SIZE Then
            RaiseEvent CallBackProc(m)
         End If

         MyBase.WndProc(m)

      End Sub

      Protected Overrides Sub Finalize()

         Me.ReleaseHandle()

         MyBase.Finalize()

      End Sub

   End Class

   &lt;StructLayout(LayoutKind.Sequential)&gt; _
   Private Structure RECT
      Friend Left As Integer
      Friend Top As Integer
      Friend Right As Integer
      Friend Bottom As Integer
   End Structure

   Private Declare Function GetParent Lib "user32" (ByVal hWnd As IntPtr) As IntPtr
   Private Declare Function GetClientRect Lib "user32" Alias "GetClientRect" (ByVal hWnd As IntPtr, ByRef lpRect As RECT) As Integer

   Private _parentHandle As IntPtr
   Private WithEvents _subClassingWindow As SubClassingWindow

   Friend Sub AddUserControl(ByVal control As UserControl)

      _parentHandle = GetParent(Me.Handle)

      _subClassingWindow = New SubClassingWindow(_parentHandle)

      control.Dock = DockStyle.Fill

      Me.Controls.Add(control)

      AdjustSize()

   End Sub

   Private Sub _subClassingWindow_CallBackProc(ByRef m As System.Windows.Forms.Message) Handles _subClassingWindow.CallBackProc

      AdjustSize()

   End Sub

   Private Sub AdjustSize()

      Dim tRect As RECT

      If GetClientRect(_parentHandle, tRect) &lt;&gt; 0 Then

         Me.Size = New Size(tRect.Right - tRect.Left, tRect.Bottom - tRect.Top)

      End If

   End Sub

   Protected Overrides Function ProcessKeyPreview(ByRef m As System.Windows.Forms.Message) As Boolean

      Const WM_KEYDOWN As Integer = &H100;

      Dim result As Boolean = False
      Dim pressedKey As Keys
      Dim hostedUserControl As UserControl
      Dim activeButton As Button

      hostedUserControl = DirectCast(Me.Controls.Item(0), UserControl)

      If m.Msg = WM_KEYDOWN Then

         pressedKey = CType(m.WParam, Keys)

         Select Case pressedKey

            Case Keys.Tab

               If Control.ModifierKeys = Keys.None Then ' Tab

                  Me.SelectNextControl(hostedUserControl.ActiveControl, True, True, True, True)
                  result = True

               ElseIf Control.ModifierKeys = Keys.Shift Then ' Shift + Tab

                  Me.SelectNextControl(hostedUserControl.ActiveControl, False, True, True, True)
                  result = True

               End If

            Case Keys.Return

               If TypeOf hostedUserControl.ActiveControl Is Button Then

                  activeButton = DirectCast(hostedUserControl.ActiveControl, Button)
                  activeButton.PerformClick()

               End If

         End Select

      End If

      If result = False Then
         result = MyBase.ProcessKeyPreview(m)
      End If

      Return result

   End Function

End Class
</pre>

<ul>
    <li>In the UserControlToolWindow1 usercontrol, add a Button named Button1 and some 
        textboxes.</li>
    <li>Replace the code of the UserControlToolWindow1 by the code below. The code sets 
        the backcolor to red to identify this toolwindow.</li>
    <li>Notice that the scope of the class has been changed to Friend, it doesn't need 
        to be Public.</li>
    <li>The usercontrol can store the VBE instance for whatever use.</li>
    <li>When testing the toolwindow, check that the Tab / Shift+Tab keystrokes change 
        the focus and that the Return key clicks the button, as expected.</li>
</ul>

<table width="100%" style="border-bottom-style:solid; border-bottom-color:Blue; border-bottom-width:1px"><tr><td>Language: VB.NET</td><td style="text-align:right"><span style="color:Blue; cursor:pointer" onclick="CopyToClipboard(document.getElementById('Code3'));">&nbsp;&nbsp;&nbsp;<img alt="Copy Code" style="border-style:none" src="/web/20211024050815im_/https://www.mztools.com/images/other/copy_code.png"/>&nbsp;Copy Code (IE only)</span></td></tr></table>

<pre class="article_source_code" id="Code3">
Imports MyCompany.Interop.VBAExtensibility
Imports System.Windows.Forms

Friend Class UserControlToolWindow1

   Private _VBE As VBE

   Friend Sub Initialize(ByVal vbe As VBE)

      Me.BackColor = Drawing.Color.Red

      _VBE = vbe

   End Sub

   Private Sub Button1_Click(sender As System.Object, e As System.EventArgs) Handles Button1.Click

      MessageBox.Show("Toolwindow shown in VBA editor version " &amp; _VBE.Version)

   End Sub

End Class
</pre>

<ul>
    <li>In the UserControlToolWindow2 usercontrol, add a Button named Button1 and some 
        textboxes.</li>
    <li>Replace the code of the UserControlToolWindow2 by the code below. The code sets 
        the backcolor to blue to identify this toolwindow.</li>
    <li>Notice that the scope of the class has been changed to Friend, it doesn't need 
        to be Public.</li>
    <li>The usercontrol can store the VBE instance for whatever use.</li>
    <li>When testing the toolwindow, check that the Tab / Shift+Tab keystrokes change 
        the focus and that the Return key clicks the button, as expected.</li>
</ul>

<table width="100%" style="border-bottom-style:solid; border-bottom-color:Blue; border-bottom-width:1px"><tr><td>Language: VB.NET</td><td style="text-align:right"><span style="color:Blue; cursor:pointer" onclick="CopyToClipboard(document.getElementById('Code4'));">&nbsp;&nbsp;&nbsp;<img alt="Copy Code" style="border-style:none" src="/web/20211024050815im_/https://www.mztools.com/images/other/copy_code.png"/>&nbsp;Copy Code (IE only)</span></td></tr></table>

<pre class="article_source_code" id="Code4">
Imports MyCompany.Interop.VBAExtensibility
Imports System.Windows.Forms

Friend Class UserControlToolWindow2

   Private _VBE As VBE

   Friend Sub Initialize(ByVal vbe As VBE)

      Me.BackColor = Drawing.Color.Blue

      _VBE = vbe

   End Sub

   Private Sub Button2_Click(sender As System.Object, e As System.EventArgs) Handles Button2.Click

      MessageBox.Show("Toolwindow shown in VBA editor version " &amp; _VBE.Version)

   End Sub

End Class
</pre>

<ul>
    <li><strong>IMPORTANT</strong>: After building the project for the first time 
        without errors, you need to register the dll as COM component (the Connect and UserControlHost public types) using the regasm.exe tool 
        with the /codebase argument as explained in the article <a href="MZ2012013.aspx">HOWTO: Create an add-in for the VBA editor (32-bit or 64-bit) of Office with Visual Studio .NET</a>.</li>
</ul>

<p class="article_section">Related articles</p>
<ul>
   <li><a href="MZ2012013.aspx">HOWTO: Create an add-in for the VBA editor (32-bit or 64-bit) of Office with Visual Studio .NET</a></li>
   <li><a href="MZ2012015.aspx">HOWTO: Adding buttons, commandbars and toolbars to the VBA editor of Office from an add-in with Visual Studio .NET</a></li>
</ul>


               </div>
            </td>
         </tr>
      </table>

      <table cellspacing="0" cellpadding="0" class="table_footer"><tr><td class="td_footer_left" width="10px"></td><td class="td_footer_center">Copyright © 2021 MZTools Software. All Rights Reserved.&nbsp;&nbsp;&nbsp;&nbsp;<a class="a_white_link" href="/web/20211024050815/https://www.mztools.com/legal_notice.aspx">Legal Notice</a></td><td class="td_footer_right" width="10px"></td></tr></table>

   </div>
</body>
</html>
<!--
     FILE ARCHIVED ON 05:08:15 Oct 24, 2021 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:59:27 Oct 08, 2022.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 250.049
  exclusion.robots: 0.28
  exclusion.robots.policy: 0.269
  cdx.remote: 0.091
  esindex: 0.011
  LoadShardBlock: 133.308 (3)
  PetaboxLoader3.datanode: 67.976 (6)
  CDXLines.iter: 21.013 (3)
  PetaboxLoader3.resolve: 154.678 (2)
  load_resource: 110.152
-->